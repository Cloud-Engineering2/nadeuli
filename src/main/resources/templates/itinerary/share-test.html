<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</head>
<body>
<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#shareModal">
    공유하기 모달 열기
</button>

<!-- 공유하기 모달창 -->
<div class="modal fade" id="shareModal" tabindex="-1" aria-labelledby="shareModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content shadow-lg rounded-4">
            <div class="modal-header border-0">
                <h5 class="modal-title fw-bold" id="shareModalLabel">공유하기</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label fw-semibold">현재 공유 상태:</label>
                    <span id="shareStatus" class="badge bg-secondary px-3 py-2">OFF</span>
                </div>

                <!-- 공유 링크 영역 (가로 정렬) -->
                <div id="shareLinkContainer" class="mb-3 d-none">
                    <label class="form-label fw-semibold">공유 링크:</label>
                    <div class="input-group">
                        <input type="text" id="shareLink" class="form-control rounded-start" readonly>
                        <button class="btn btn-outline-primary rounded-end" id="copyLinkBtn">
                            <i class="bi bi-clipboard"></i> 복사
                        </button>
                    </div>
                </div>

                <!-- Owner 버튼 -->
                <button class="btn btn-primary w-100 mb-2 py-2 fw-semibold" id="generateLinkBtn">
                    <i class="bi bi-link-45deg"></i> 공유 링크 생성
                </button>
                <button class="btn btn-danger w-100 d-none py-2 fw-semibold" id="disableShareBtn">
                    <i class="bi bi-x-circle"></i> 공유 끄기
                </button>

                <!-- Collaborator 목록 -->
                <h6 class="mt-3 fw-bold">Collaborators</h6>
                <ul class="list-group border-0">
                    <li class="list-group-item bg-light fw-semibold">Owner</li>
                    <ul id="ownerList" class="list-group mb-2"></ul>
                    <li class="list-group-item bg-light fw-semibold">Guest</li>
                    <ul id="guestList" class="list-group"></ul>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap Icons (필요한 경우 추가) -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">

<script>

    $(document).ready(function () {
        // 가짜 데이터 (백엔드에서 받아올 예정)
        let itinerary = {
            id: 1,
            isShared: false,
            role: "Owner",
            collaborators: [
                { name: "Alice", role: "Owner" },
                { name: "Bob", role: "Guest" },
                { name: "Charlie", role: "Guest" }
            ]
        };

        function updateModalUI() {
            $("#ownerList").empty();
            $("#guestList").empty();

            itinerary.collaborators.forEach(collab => {
                let listItem = `<li class="list-group-item">${collab.name}</li>`;
                if (collab.role === "Owner") {
                    $("#ownerList").append(listItem);
                } else {
                    $("#guestList").append(listItem);
                }
            });

            if (itinerary.isShared) {
                $("#shareStatus").text("ON").removeClass("bg-secondary").addClass("bg-success");
                $("#shareLinkContainer").removeClass("d-none");
                $("#shareLink").val(`https://example.com/share/${itinerary.id}`);

                $("#disableShareBtn").removeClass("d-none");
                $("#generateLinkBtn").addClass("d-none");
                $("#copyLinkBtn").prop("disabled", false);
            } else {
                $("#shareStatus").text("OFF").removeClass("bg-success").addClass("bg-secondary");
                $("#shareLinkContainer").addClass("d-none");
                $("#disableShareBtn").addClass("d-none");

                let owner = itinerary.collaborators.find(c => c.role === "Owner");
                if (owner) {
                    $("#generateLinkBtn").removeClass("d-none").prop("disabled", false);
                } else {
                    $("#generateLinkBtn").prop("disabled", true);
                }
            }
        }

        // 공유 링크 생성
        $("#generateLinkBtn").click(function () {
            itinerary.isShared = true;
            updateModalUI();
        });

        // 공유 해제
        $("#disableShareBtn").click(function () {
            itinerary.isShared = false;
            updateModalUI();
        });

        // 링크 복사
        $("#copyLinkBtn").click(function () {
            let copyText = $("#shareLink");
            copyText.select();
            document.execCommand("copy");
            alert("링크가 복사되었습니다.");
        });

        // 모달 열릴 때 UI 업데이트
        $("#shareModal").on("show.bs.modal", function () {
            updateModalUI();
        });
    });


</script>

</body>
</html>