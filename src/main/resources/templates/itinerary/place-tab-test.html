<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>장소 추가</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
    <style>
        /* 기본 스크롤바 스타일 */
        /* 공통 스타일 */
        body {
            scrollbar-width: thin; /* Firefox용 얇은 스크롤바 */
            scrollbar-color: #888 #ddd; /* thumb: 회색, track: 연한 회색 */
        }
        /* 모든 요소에 적용 */
        * {
            /* 스크롤바 색상 설정: 엄지(thumb)와 트랙(track) */
            scrollbar-color: #888 #f1f1f1;
            /* 스크롤바 두께 설정: 'auto' 또는 'thin' */
            scrollbar-width: thin;
        }

        /* WebKit 기반 브라우저를 위한 비표준 구현 */
        ::-webkit-scrollbar {
            width: 8px; /* 세로 스크롤바 너비 */
            height: 8px; /* 가로 스크롤바 높이 */
        }

        ::-webkit-scrollbar-thumb {
            background-color: #888;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }


        html, body {
            height: 100%;
            margin: 0;
            overflow: hidden; /* 스크롤 제거 */
        }

        .container {
            margin: 0;
            width: 500px;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .tab-content-wrap {
            flex-grow: 1;
            display: flex;
            height: 100%;
        }

        .search-area {
            width: 100%;
            margin: 0;
            padding: 20px;
            border-right: 2px solid #ddd;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .search-container {
            display: flex;
            user-select: none;
            align-items: center;
            width: 100%;
            min-height: 50px;
            height: 50px;
            background-color: #ffffff;
            border-radius: 25px;
            border: 1px solid #ddd;
            padding: 0 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            position: relative;
        }
        .search-icon, .search-clear {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            font-size: 16px;
            user-select: none;
            color: #666;
            cursor: pointer;
        }
        .search-input {
            flex-grow: 1;
            border: none;
            background-color: transparent;
            height: 100%;
            font-size: 1em;
            padding: 0 10px;
        }
        .search-input:focus {
            outline: none;
        }

        .map-area {
            height: 200px; /* 지도 영역 고정 높이 */
            margin-top: 10px;
        }
        #map {
            width: 100%;
            height: 200px;
        }

        .search-results-header {
            font-weight: bold;
            font-size: 1rem;
            text-align: center;
            padding: 15px 10px 5px 10px;
        }

        .search-results-wrap {
            flex-grow: 1;
            overflow-y: auto;
        }

        #google-search-results {
            min-height: 100px;
            padding: 10px;
            background-color: #f3f3f3;
        }

        .google-result-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 13px 13px;
            margin-bottom: 8px;
            border-radius: 8px;
            background: white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .google-result-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .google-result-title {
            font-size: 1rem;
            font-weight: bold;
            color: #333;
        }

        .google-result-address {
            font-size: 0.8rem;
            color: #666;
        }

        .google-result-tags {
            font-size: 0.9rem;
            color: #555;
            font-weight: normal;
        }

        .google-register-btn {
            padding: 5px 10px;
            font-size: 0.8rem;
            white-space: nowrap;
        }


        /* ✅ 탭 버튼 스타일 */
        .custom-tabs {
            user-select: none;
            display: flex;
            width: 100%;
            border-bottom: 2px solid #ddd;
        }

        .tab-button {
            flex: 1; /* 너비를 1/2씩 */
            padding: 15px;
            text-align: center;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            background-color: white;
            border: none;
            border-bottom: 2px solid transparent;
            transition: border-bottom 0.3s;
        }

        .tab-button.active {
            border-bottom: 2px solid #007bff; /* 활성 탭 표시 */
        }

        .tab-content {
            width: 100%;
        }

        .tab-pane {
            height: 100%;
            display: none; /* 기본적으로 숨김 */
        }

        .tab-pane.active {
            display: block; /* 활성화된 탭만 표시 */
        }

        .filter-buttons {
            user-select: none;
            display: flex;
            gap: 4px;
            margin-top: 10px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }

        .filter-button {
            padding: 1px 11px;
            font-size: 0.9em;
            border: 1px solid #007bff;
            background: white;
            color: #007bff;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .filter-button.active {
            background: #007bff;
            color: white;
        }

        .list-item {
            user-select: none;
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 0 10px 20px 10px;

            cursor: pointer;
            transition: background-color 0.3s;
        }


        .list-item img {
            width: 73px;
            height: 73px;
            border-radius: 5px;
            object-fit: cover;
            margin-right: 20px;
        }


        .list-item .info {
            flex-grow: 1;
        }

        .list-item .title {
            font-weight: bold;
            font-size: 0.9em;
        }

        .info-line {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.8em;
            color: #666;
        }

        .address {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 300px;
        }

        .like, .star {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9em;
        }

        .bi-heart {
            color: red;
        }

        .bi-star-fill {
            color: gold;
        }
        .add-button-wrap {

            width: 30px;
            height: 72px;

        }
        .add-button {

            height: 100%;
            width: 100%;
            border-radius: 5px;
            border: none;
            background-color: #007bff;
            color: white;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }



        #nadeuli-search-results{
            /*background-color: #00ff59;*/
        }

    </style>
</head>
    <body onload="loadGoogleMapsApi()">
        <div class="container">
            <!-- ✅ 커스텀 탭 버튼 -->
            <div class="custom-tabs">
                <button class="tab-button active" id="nadeuli-tab-btn" onclick="showTab('nadeuli-search-tab')">추천 장소 검색</button>
                <button class="tab-button" id="google-tab-btn" onclick="showTab('google-search-tab')">미등록 장소 추가</button>
            </div>

            <div class="tab-content-wrap">
                <div class="tab-content">
                    <!-- ✅ 나들이 서버 검색 탭 -->
                    <div class="tab-pane active" id="nadeuli-search-tab">
                        <div class="search-area">
                            <div class="search-container">
                                <span class="search-icon" onclick="searchNadeuliPlaces()"><i class="bi bi-search"></i></span>
                                <input type="text" id="nadeuli-place-search" class="search-input" placeholder="나들이 장소 검색" autocomplete="off" onkeydown="handleNadeuliKeyPress(event)" />
                                <span class="search-clear" onclick="clearNadeuliSearch()"><i class="bi bi-x"></i></span>
                            </div>
                            <div class="filter-buttons">
                                <button class="filter-button" data-filter="attraction">명소</button>
                                <button class="filter-button" data-filter="restaurant">식당</button>
                                <button class="filter-button" data-filter="accommodation">숙소</button>
                                <button class="filter-button" data-filter="cafe">카페</button>
                                <button class="filter-button" data-filter="transport">교통</button>
                                <button class="filter-button" data-filter="amenity">편의시설</button>
                            </div>
                            <div class="search-results-wrap" id="nadeuli-search-results">
                                <div class="list-item" data-id="place-1">
                                    <img src="https://d2tfgua35fdi4.cloudfront.net/journal/dc04d238-69db-467f-a09c-88bc5c8a41d0_ChIJvcDN4cNbDDURpAdMx-0uviI.jpg" alt="장소 이미지" />
                                    <div class="info">
                                        <div class="title">성산 일출봉</div>
                                        <div class="info-line"><div class="place-type">명소</div> <div class="address" title="대한민국 서귀포시 성산 일출봉">대한민국 서귀포시 성산 일출봉</div></div>
                                        <div class="info-line"> <div class="like"><i class="bi bi-heart"></i> 120</div><div class="star"><i class="bi bi-star-fill"></i> 4.5</div></div>
                                    </div>
                                    <div class="add-button-wrap">
                                        <button class="add-button">+</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ✅ Google 검색 탭 -->
                    <div class="tab-pane" id="google-search-tab">
                        <div class="search-area">
                            <div class="search-container">
                                <span class="search-icon" onclick="searchGooglePlaces()"><i class="bi bi-search"></i></span>
                                <input type="text" id="google-place-search" class="search-input" placeholder="Google 장소 검색" autocomplete="off" onkeydown="handleGoogleKeyPress(event)" />
                                <span class="search-clear" onclick="clearGoogleSearch()"><i class="bi bi-x"></i></span>
                            </div>
                            <div class="map-area">
                                <div id="map"></div>
                            </div>
                            <div id="google-search-results-header" class="search-results-header">검색 결과 총 0건</div>
                            <div class="search-results-wrap">
                                <div id="google-search-results" class="list-group"></div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>


<script>

    let map;
    let markers = [];
    const placeTypeTranslations={"car_dealer":"자동차 딜러","car_rental":"렌터카","car_repair":"자동차 정비소","car_wash":"세차장","electric_vehicle_charging_station":"전기차 충전소","gas_station":"주유소","parking":"주차장","rest_stop":"휴게소","corporate_office":"기업 사무실","farm":"농장","ranch":"목장","art_gallery":"미술관","art_studio":"예술 작업실","auditorium":"강당","cultural_landmark":"문화 랜드마크","historical_place":"유적지","monument":"기념비","museum":"박물관","performing_arts_theater":"공연 예술 극장","sculpture":"조각상","library":"도서관","preschool":"유치원","primary_school":"초등학교","school":"학교","secondary_school":"중·고등학교","university":"대학교","adventure_sports_center":"익스트림 스포츠 센터","amphitheatre":"원형 극장","amusement_center":"오락 센터","amusement_park":"놀이공원","aquarium":"수족관","banquet_hall":"연회장","barbecue_area":"바베큐 구역","botanical_garden":"식물원","bowling_alley":"볼링장","casino":"카지노","childrens_camp":"어린이 캠프","comedy_club":"코미디 클럽","community_center":"커뮤니티 센터","concert_hall":"콘서트 홀","convention_center":"컨벤션 센터","cultural_center":"문화 센터","cycling_park":"자전거 공원","dance_hall":"댄스홀","dog_park":"애견 공원","event_venue":"이벤트 장소","ferris_wheel":"대관람차","garden":"정원","hiking_area":"등산로","historical_landmark":"역사적 랜드마크","internet_cafe":"인터넷 카페","karaoke":"노래방","marina":"마리나 (항구)","movie_rental":"비디오 대여점","movie_theater":"영화관","national_park":"국립공원","night_club":"나이트클럽","observation_deck":"전망대","off_roading_area":"오프로드 지역","opera_house":"오페라 하우스","park":"공원","philharmonic_hall":"필하모닉 홀","picnic_ground":"소풍 장소","planetarium":"천문관","plaza":"광장","roller_coaster":"롤러코스터","skateboard_park":"스케이트 공원","state_park":"주립공원","tourist_attraction":"관광명소","video_arcade":"비디오 아케이드","visitor_center":"방문자 센터","water_park":"워터파크","wedding_venue":"웨딩홀","wildlife_park":"야생동물 공원","wildlife_refuge":"야생동물 보호구역","zoo":"동물원","public_bath":"대중목욕탕","public_bathroom":"공중화장실","stable":"마구간","accounting":"회계 사무소","atm":"ATM","bank":"은행","acai_shop":"아사이 볼 전문점","afghani_restaurant":"아프가니스탄 음식점","african_restaurant":"아프리카 음식점","american_restaurant":"아메리칸 레스토랑","asian_restaurant":"아시안 레스토랑","bagel_shop":"베이글 가게","bakery":"베이커리","bar":"바","bar_and_grill":"바 & 그릴","barbecue_restaurant":"바베큐 레스토랑","brazilian_restaurant":"브라질 음식점","breakfast_restaurant":"조식 전문점","brunch_restaurant":"브런치 레스토랑","buffet_restaurant":"뷔페 레스토랑","cafe":"카페","cafeteria":"구내식당","candy_store":"캔디샵","cat_cafe":"고양이 카페","chinese_restaurant":"중식당","chocolate_factory":"초콜릿 공장","chocolate_shop":"초콜릿 가게","coffee_shop":"커피숍","confectionery":"과자점","deli":"델리","dessert_restaurant":"디저트 레스토랑","dessert_shop":"디저트 가게","diner":"다이너","dog_cafe":"강아지 카페","donut_shop":"도넛 가게","fast_food_restaurant":"패스트푸드점","fine_dining_restaurant":"파인다이닝 레스토랑","food_court":"푸드코트","french_restaurant":"프랑스 음식점","greek_restaurant":"그리스 음식점","hamburger_restaurant":"햄버거 가게","ice_cream_shop":"아이스크림 가게","indian_restaurant":"인도 음식점","indonesian_restaurant":"인도네시아 음식점","italian_restaurant":"이탈리아 음식점","japanese_restaurant":"일식당","juice_shop":"주스 전문점","korean_restaurant":"한식당","lebanese_restaurant":"레바논 음식점","meal_delivery":"배달 전문점","meal_takeaway":"테이크아웃 전문점","mediterranean_restaurant":"지중해 음식점","mexican_restaurant":"멕시코 음식점","middle_eastern_restaurant":"중동 음식점","pizza_restaurant":"피자 가게","pub":"펍","ramen_restaurant":"라멘 전문점","restaurant":"레스토랑","sandwich_shop":"샌드위치 가게","seafood_restaurant":"해산물 레스토랑","spanish_restaurant":"스페인 음식점","steak_house":"스테이크 하우스","sushi_restaurant":"스시 레스토랑","tea_house":"찻집","thai_restaurant":"태국 음식점","turkish_restaurant":"터키 음식점","vegan_restaurant":"비건 레스토랑","vegetarian_restaurant":"채식 레스토랑","vietnamese_restaurant":"베트남 음식점","wine_bar":"와인 바","administrative_area_level_1":"광역 행정구역","administrative_area_level_2":"지방 행정구역","country":"국가","locality":"지역","postal_code":"우편번호","school_district":"학군","city_hall":"시청","courthouse":"법원","embassy":"대사관","fire_station":"소방서","government_office":"정부 기관","local_government_office":"지방 정부 기관","neighborhood_police_station":"지구대 (일본만 해당)","police":"경찰서","post_office":"우체국","chiropractor":"카이로프랙틱","dental_clinic":"치과 클리닉","dentist":"치과 의사","doctor":"의사","drugstore":"약국","hospital":"병원","massage":"마사지샵","medical_lab":"의료 실험실","pharmacy":"약국","physiotherapist":"물리 치료사","sauna":"사우나","skin_care_clinic":"피부 관리 클리닉","spa":"스파","tanning_studio":"태닝 스튜디오","wellness_center":"웰니스 센터","yoga_studio":"요가 스튜디오","apartment_building":"아파트 건물","apartment_complex":"아파트 단지","condominium_complex":"콘도미니엄 단지","housing_complex":"주택 단지","bed_and_breakfast":"B&B 숙소","budget_japanese_inn":"일본 저가 숙소","campground":"캠핑장","camping_cabin":"캠핑용 오두막","cottage":"코티지","extended_stay_hotel":"장기 체류 호텔","farmstay":"팜스테이","guest_house":"게스트하우스","hostel":"호스텔","hotel":"호텔","inn":"여관","japanese_inn":"료칸","lodging":"숙박시설","mobile_home_park":"이동식 주택 단지","motel":"모텔","private_guest_room":"개인 게스트룸","resort_hotel":"리조트 호텔","rv_park":"RV 주차장","beach":"해변","church":"교회","hindu_temple":"힌두교 사원","mosque":"모스크","synagogue":"유대교 회당","astrologer":"점성술사","barber_shop":"이발소","beautician":"미용 전문가","beauty_salon":"미용실","body_art_service":"바디아트 서비스","catering_service":"출장 요리 서비스","cemetery":"공동묘지","child_care_agency":"보육 기관","consultant":"컨설팅 서비스","courier_service":"택배 서비스","electrician":"전기 기사","florist":"꽃집","food_delivery":"음식 배달 서비스","foot_care":"발 관리 서비스","funeral_home":"장례식장","hair_care":"헤어 관리","hair_salon":"미용실","insurance_agency":"보험 대리점","laundry":"세탁소","lawyer":"변호사","locksmith":"열쇠 수리점","makeup_artist":"메이크업 아티스트","moving_company":"이사 업체","nail_salon":"네일숍","painter":"도장업체","plumber":"배관공","psychic":"심령술사","real_estate_agency":"부동산 중개업","roofing_contractor":"지붕 공사업체","storage":"창고","summer_camp_organizer":"여름 캠프 기획사","tailor":"재단사","telecommunications_service_provider":"통신 서비스 제공업체","tour_agency":"여행사","tourist_information_center":"관광 안내소","travel_agency":"여행사","veterinary_care":"동물 병원","asian_grocery_store":"아시아 식료품점","auto_parts_store":"자동차 부품 상점","bicycle_store":"자전거 가게","book_store":"서점","butcher_shop":"정육점","cell_phone_store":"휴대폰 매장","clothing_store":"의류 매장","convenience_store":"편의점","department_store":"백화점","discount_store":"할인 매장","electronics_store":"전자제품 매장","food_store":"식료품점","furniture_store":"가구 매장","gift_shop":"기념품 가게","grocery_store":"슈퍼마켓","hardware_store":"철물점","home_goods_store":"생활용품 매장","home_improvement_store":"DIY/인테리어 매장","jewelry_store":"보석 가게","liquor_store":"주류 판매점","market":"시장","pet_store":"애완동물 가게","shoe_store":"신발 가게","shopping_mall":"쇼핑몰","sporting_goods_store":"스포츠 용품점","store":"상점","supermarket":"대형 마트","warehouse_store":"창고형 매장","wholesaler":"도매점","arena":"경기장","athletic_field":"운동장","fishing_charter":"낚시 여행","fishing_pond":"낚시터","fitness_center":"헬스장","golf_course":"골프장","gym":"체육관","ice_skating_rink":"아이스링크","playground":"놀이터","ski_resort":"스키 리조트","sports_activity_location":"스포츠 활동 장소","sports_club":"스포츠 클럽","sports_coaching":"스포츠 코칭 센터","sports_complex":"스포츠 복합 시설","stadium":"스타디움","swimming_pool":"수영장","airport":"공항","airstrip":"소형 비행장","bus_station":"버스 터미널","bus_stop":"버스 정류장","ferry_terminal":"페리 터미널","heliport":"헬리포트","international_airport":"국제공항","light_rail_station":"경전철 역","park_and_ride":"환승 주차장","subway_station":"지하철역","taxi_stand":"택시 승강장","train_station":"기차역","transit_depot":"교통 환승센터","transit_station":"대중교통 환승역","truck_stop":"트럭 정류장","administrative_area_level_3":"행정구역 (레벨 3)","administrative_area_level_4":"행정구역 (레벨 4)","administrative_area_level_5":"행정구역 (레벨 5)","administrative_area_level_6":"행정구역 (레벨 6)","administrative_area_level_7":"행정구역 (레벨 7)","archipelago":"군도","colloquial_area":"비공식 지역명","continent":"대륙","establishment":"시설","finance":"금융","floor":"층","food":"음식","general_contractor":"종합 건설업체","geocode":"지리적 코드","health":"건강","intersection":"교차로","landmark":"랜드마크","natural_feature":"자연 지형","neighborhood":"주변 지역","place_of_worship":"예배 장소","plus_code":"플러스 코드","point_of_interest":"관심 지점","political":"정치적 구역","post_box":"우편함","postal_code_prefix":"우편번호 접두사","postal_code_suffix":"우편번호 접미사","postal_town":"우편도시","premise":"건물","room":"방","route":"경로","street_address":"도로명 주소","street_number":"도로명 주소 번호","sublocality":"하위 지역","sublocality_level_1":"하위 지역 (레벨 1)","sublocality_level_2":"하위 지역 (레벨 2)","sublocality_level_3":"하위 지역 (레벨 3)","sublocality_level_4":"하위 지역 (레벨 4)","sublocality_level_5":"하위 지역 (레벨 5)","subpremise":"건물 내 구역","town_square":"타운 스퀘어"};
    const excludedPlaceTypes=["administrative_area_level_1","administrative_area_level_2","administrative_area_level_3","administrative_area_level_4","administrative_area_level_5","administrative_area_level_6","administrative_area_level_7","colloquial_area","continent","country","locality","neighborhood","political","postal_code","postal_code_prefix","postal_code_suffix","postal_town","school_district","sublocality","sublocality_level_1","sublocality_level_2","sublocality_level_3","sublocality_level_4","sublocality_level_5","plus_code","establishment","floor","premise","subpremise","room","street_address","street_number","intersection","route","corporate_office","general_contractor","real_estate_agency","insurance_agency","lawyer","accounting","finance","storage","telecommunications_service_provider","moving_company","electrician","plumber","roofing_contractor","courier_service","warehouse_store","wholesaler","auto_parts_store","butcher_shop","beauty_salon","nail_salon","hair_salon","barber_shop","tanning_studio","makeup_artist","foot_care","psychic","astrologer","apartment_building","apartment_complex","condominium_complex","housing_complex","mobile_home_park","church","hindu_temple","mosque","synagogue","place_of_worship","chiropractor","physiotherapist","skin_care_clinic","medical_lab","wellness_center","child_care_agency","summer_camp_organizer","consultant","painter","tailor","point_of_interest"]



    document.addEventListener("DOMContentLoaded", initMap);

// ➡️ 나들이 장소 검색 관련
//===============================================================================


    function handleNadeuliKeyPress(event) {
        if (event.key === "Enter") {
            event.preventDefault();
            searchNadeuliPlaces();
        }
    }
    function searchNadeuliPlaces() {
        let query = document.getElementById("nadeuli-place-search").value;
        if (!query) return;

        $.ajax({
            url: "/api/places/search",
            type: "GET",
            data: { query: query },
            success: function (data) {
                let results = data.places || [];
                // displaySearchResults(results, "nadeuli");
            },
            error: function (error) {
                console.error("나들이 검색 오류:", error);
            }
        });
    }
    function clearNadeuliSearch() {
        document.getElementById("nadeuli-place-search").value = "";
        document.getElementById("nadeuli-search-results").innerHTML = "";
        document.getElementById("nadeuli-search-results-header").innerText = "검색 결과 총 0건";
    }



// ➡️ 구글 Place TextSearch 관련
//===============================================================================

    // 구글 Place Text Search
    function searchGooglePlaces() {
        let query = document.getElementById("google-place-search").value;
        if (!query) return;

        let location = { lat: 33.4996, lng: 126.5312 }; // 제주도 위도, 경도
        let radius = 50000; // 반경 50km

        $.ajax({
            url: "/api/google-places/search",
            type: "GET",
            data: {
                query: query,
                lat: location.lat,
                lng: location.lng,
                radius: radius
            },
            success: function (data) {
                try {
                    let parsedData = typeof data === "string" ? JSON.parse(data) : data; // JSON 문자열인지 확인 후 변환
                    let results = parsedData.places || []; // `places` 키에서 데이터 가져오기
                    clearMarkers();
                    displayGoogleSearchResults(results);
                } catch (error) {
                    console.error("JSON parsing error:", error);
                }
            },
            error: function (error) {
                console.error("Error fetching data from backend:", error);
            }
        });
    }

    // 구글 Place Text Search 결과 출력
    function displayGoogleSearchResults(places) {
        let resultsContainer = document.getElementById(`google-search-results`);
        let resultsHeader = document.getElementById(`google-search-results-header`)

        resultsHeader.innerText = `검색 결과 총${places.length}건`; // 검색 개수 업데이트
        resultsContainer.innerHTML = ""; // 기존 결과 초기화
        places.forEach((place) => {
            let placeName = place.displayName?.text || "이름 없음";
            let address = place.formattedAddress || "주소 정보 없음";
            let location = new google.maps.LatLng(place.location.latitude, place.location.longitude);
            let placeId = place.id || ""; // placeId 저장

            let filteredTypes = place.types ? translatePlaceTypes(place.types) : [];
            let typesText = filteredTypes.length > 0 ? filteredTypes.join(", ") : "";

            let listItem = document.createElement("div");
            listItem.className = "google-result-item";
            listItem.setAttribute("data-id", placeId); // placeId 저장

            listItem.innerHTML = `
            <div class="google-result-content">
                <div class="google-result-title">${placeName}</div>
                <div class="google-result-address">${address}</div>
                <div class="google-result-tags">${typesText}</div>
            </div>
            <button class="btn btn-sm btn-secondary register-btn" onclick="registerPlace(this)">
                등록
            </button>
        `;

            listItem.onclick = () => selectGooglePlace(location);
            resultsContainer.appendChild(listItem);

            let marker = new google.maps.Marker({
                position: location,
                map: map,
                title: placeName,
            });
            markers.push(marker);
        });

        if (places.length > 0) {
            map.setCenter(new google.maps.LatLng(places[0].location.latitude, places[0].location.longitude));
        }
    }

    // 구글 Place 장소타입 한글 변환 함수
    function translatePlaceTypes(types) {
        return types
            .filter(type => !excludedPlaceTypes.includes(type)) // 제외 리스트 필터링
            .map(type => placeTypeTranslations[type] || `#${type.replace(/_/g, ' ')}`); // 한글 변환 or 해시태그 스타일
    }

    // 구글 Place 검색창 초기화
    function clearGoogleSearch() {
        document.getElementById("google-place-search").value = "";
        document.getElementById("google-search-results").innerHTML = "";
        document.getElementById("google-search-results-header").innerText = "검색 결과 총 0건";
        clearMarkers();
    }

    //구글맵 마커삭제
    function clearMarkers() {
        markers.forEach((marker) => marker.setMap(null));
        markers = [];
    }

    // 구글 지역 선택시 지역이동
    function selectGooglePlace(location) {
        map.setCenter(location);
        map.setZoom(15);
    }

    // 구글 Place -> 나들이서버 장소 추가
    function registerPlace(button) {
        let listItem = button.closest(".google-result-item");
        let placeId = listItem.getAttribute("data-id"); // data-id에서 placeId 가져오기
        let name = listItem.querySelector(".google-result-title").innerText;
        let address = listItem.querySelector(".google-result-address").innerText;

        if (!placeId) {
            alert("❌ Place ID가 없습니다. 다시 시도해주세요.");
            return;
        }

        // 1️⃣ 사용자 확인
        if (!confirm(`${name} 장소를 등록하시겠습니까?`)) {
            return;
        }

        // 2️⃣ 장소 등록 API 호출
        $.ajax({
            url: "/api/place/register",
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify({
                placeId: placeId, // Google Place ID로 등록
            }),
            success: function (response) {
                // 3️⃣ 성공 처리
                if (response.status === 201) {
                    alert(`✅ 장소가 성공적으로 등록되었습니다: ${name}`);
                } else if (response.status === 200) {
                    alert(`⚠ 이미 등록된 장소입니다: ${name}`);
                }
            },
            error: function (error) {
                // 4️⃣ 실패 처리
                console.error("🚨 장소 등록 실패:", error);
                alert("❌ 장소 등록에 실패했습니다. 다시 시도해주세요.");
            }
        });
    }

    //구글 검색창에서 엔터키 누를시 검색
    function handleGoogleKeyPress(event) {
        if (event.key === "Enter") {
            event.preventDefault();
            searchGooglePlaces();
        }
    }





// ➡️ 기타 유틸리티
//=======================================================================

    // 장소추가 탭 변경
    function showTab(tabId) {
        // 모든 탭 숨기기
        document.querySelectorAll(".tab-pane").forEach(tab => {
            tab.classList.remove("active");
        });

        // 선택한 탭 활성화
        document.getElementById(tabId).classList.add("active");

        // 모든 탭 버튼에서 active 제거
        document.querySelectorAll(".tab-button").forEach(button => {
            button.classList.remove("active");
        });

        // 선택한 버튼 활성화
        if (tabId === "nadeuli-search-tab") {
            document.getElementById("nadeuli-tab-btn").classList.add("active");
        } else {
            document.getElementById("google-tab-btn").classList.add("active");
        }
    }

    // 맵 초기화
    function initMap() {
        map = new google.maps.Map(document.getElementById("map"), {
            center: { lat: 37.5665, lng: 126.9780 },
            zoom: 13,
        });
    }

    // 구글 Place api키 GITHUB 및 검색엔진에서 숨기기 위한 함수
    function loadGoogleMapsApi() {
        fetch('/api/google-places/apikey')
            .then(response => response.text())
            .then(apiKey => {
                let script = document.createElement("script");
                script.src = `https://maps.googleapis.com/maps/api/js?key=${apiKey}&libraries=places&callback=initMap`;
                script.async = true;
                script.defer = true;
                document.head.appendChild(script);
            })
            .catch(error => console.error("API Key 가져오기 실패:", error));
    }



</script>
</body>
</html>