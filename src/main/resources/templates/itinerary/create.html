<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚˜ë“¤ì´</title>



    <!-- jQuery & Bootstrap -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">

    <!-- Moment.js & Date Range Picker -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery-date-range-picker/dist/daterangepicker.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery-date-range-picker/dist/jquery.daterangepicker.min.js"></script>

       <!-- Toast Alarm -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <link rel="stylesheet" href="/css/common.css">
    <link rel="stylesheet" href="/css/create.css">
</head>
<body>
<div th:replace="fragments/header :: headerFragment"></div>
<div class="modal fade" id="travelModal" data-bs-backdrop="static" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content p-4">
            <div class="modal-header border-0">
                <h2 class="modal-title text-center w-100 fw-light" id="modal-title">ì—¬í–‰ ì§€ì—­ì„ ì„ íƒí•´ì£¼ì„¸ìš”</h2>
                <button type="button" class="btn-close position-absolute" data-bs-dismiss="modal" aria-label="Close" style="top: 15px; right: 15px;"></button>
            </div>
            <div class="modal-body text-center" id="modal-body">
                <div id="step-container">
                    <!-- ì—¬í–‰ ê¸°ê°„ ì„ íƒ -->
                    <div id="step-region-selection">
                        <p class="fw-light">ì§€ì—­ì€ ìµœëŒ€ 2ê°œ ê¹Œì§€ë§Œ ì„¤ì • ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
                        <div class="section-region-select">
                            <div class="search-box-wrap">
                                <span class="search-box-left"><i class="bi bi-search"></i></span>
                                <input type="text" id="search-box" placeholder="ì–´ë””ë¡œ ì—¬í–‰ê°€ì„¸ìš”?" autocomplete="off"/>
                                <span class="search-box-right"><i class="bi bi-x"></i></span>
                            </div>
                            <div class="suggestions-wrap">
                                <ul id="suggestions"></ul>
                            </div>
                        </div>

                        <ul id="selectedList" class="region-card-container"></ul>
                        <div class="name-select-container">
                            <span id="name-box-span">ì—¬í–‰ ì´ë¦„</span> <input type="text" id="name-box" placeholder="ì—¬í–‰ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”" autocomplete="off"/>
                        </div>

                    </div>
                    <!-- ì—¬í–‰ ê¸°ê°„ ì„ íƒ -->
                    <div id="step-date-selection">
                        <p class="fw-light">ì—¬í–‰ ì¼ìëŠ” ìµœëŒ€ 7ì¼ê¹Œì§€ ì„¤ì • ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
                        <div id="date-range-container" class="mb-3"></div>
                        <p><span id="selected-date">ã€€</span></p>
                    </div>

                    <!-- ì‹œì‘/ì¢…ë£Œ ì‹œê°„ ì„¤ì • -->
                    <div id="step-time-selection">
                        <div class="time-container">
                            <span class="date-label">ì „ì²´ ì ìš©</span>
                            <input type="time" id="start-global" class="form-control time-input" value="09:00">
                            <input type="time" id="end-global" class="form-control time-input" value="23:00">
                            <button id="apply-global-time" class="btn btn-secondary" >ì „ì²´ ì ìš©</button>
                        </div>
                        <hr>
                        <div id="time-selection-container"></div>
                    </div>
                </div>
            </div>
            <div class="modal-footer border-0 d-flex justify-content-between">
                <button id="back-btn" class="btn btn-secondary" style="visibility: hidden;">ë’¤ë¡œ ê°€ê¸°</button>
                <button id="next-btn" class="btn btn-dark">ë‹¤ìŒ</button>
            </div>
        </div>
    </div>
</div>

<script>

    // ì „ì—­ë³€ìˆ˜ ì„ ì–¸ (í˜¸ì´ìŠ¤íŒ…)
    // let travelModal;
    // let selectedDates = [];

    // function createTimeSelectionUI(selectedDates, dayCounts) {
    //     console.log("ğŸ“Œ [ì‹œê°„ UI ìƒì„±] ì„ íƒëœ ë‚ ì§œë“¤:", selectedDates);
    //
    //     // 1ë¶€í„° dayCountsê¹Œì§€ì˜ ë¦¬ìŠ¤íŠ¸ ìƒì„±
    //     let dayList = Array.from({ length: dayCounts }, (_, i) => i + 1);
    //
    //
    //     let timeSelectionHTML = "";
    //     dayList.forEach(index => {
    //         timeSelectionHTML += `
    //             <div class="time-container mb-3">
    //                 <span class="date-label">${index}:</span>
    //                 <input type="time" class="form-control time-input" id="start-${index}" value="09:00">
    //                 <input type="time" class="form-control time-input" id="end-${index}" value="23:00">
    //             </div>
    //         `;
    //     });
    //
    //     $('#time-selection-container').html(timeSelectionHTML);
    //
    // }


    // $(document).ready(function () {
    //     console.log("ğŸ“… ìº˜ë¦°ë” ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œë¨");
    //
    //     travelModal = new bootstrap.Modal(document.getElementById("travelModal"));
    //     const timeModalElement = document.getElementById("timeModal"); // âœ… HTML ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
    //     travelModal.show();


        //===============================
        //  ğŸ“… ìº˜ë¦°ë” ìŠ¤í¬ë¦½íŠ¸
        //================================
        // $('#date-range-container').dateRangePicker({
        //     parentEl: "modal-body",
        //     inline: true,
        //     container: '#date-range-container',
        //     alwaysOpen: true,
        //     stickyMonths: true,
        //     language: 'ko',
        //     format: 'YYYY-MM-DD',
        //     separator: ' ~ ',
        //     startOfWeek: 'sunday',
        //     showShortcuts: false,
        //     customTopBar: ' ',
        //     hoveringTooltip: false,
        //     autoClose: true
        // }).bind('datepicker-change', function (event, obj) {
        //     let tempSelectedDates = [];
        //     let start = moment(obj.date1);
        //     let end = moment(obj.date2);
        //
        //     while (start <= end) {
        //         tempSelectedDates.push(start.format('YYYY-MM-DD'));
        //         start.add(1, 'days');
        //     }
        //
        //     selectedDates = tempSelectedDates;
        //     console.log("âœ… ì„ íƒëœ ë‚ ì§œ:", selectedDates);
        //
        //     $('#selected-date')
        //         .text(obj.value)
        //         .css({ opacity: 0 })
        //         .animate({ opacity: 1 }, 500);
        // });

    //     $('#confirm-dates-btn').click(function () {
    //         console.log("ğŸ“Œ [ë²„íŠ¼ í´ë¦­] 'ë‹¤ìŒ' ë²„íŠ¼ í´ë¦­ë¨");
    //
    //         if (selectedDates.length === 0) {
    //             alert("ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”.");
    //             return;
    //         }
    //
    //         console.log("âœ… ì„ íƒëœ ë‚ ì§œ:", selectedDates);
    //         createTimeSelectionUI(selectedDates, selectedDates.length);
    //
    //         travelModal.hide();
    //
    //         // âœ… Bootstrap ëª¨ë‹¬ ì¸ìŠ¤í„´ìŠ¤ ìƒì„± (ì—¬ê¸°ì„œ í•œ ë²ˆë§Œ ìƒì„±)
    //         if (!timeModal) {
    //             timeModal = new bootstrap.Modal(timeModalElement);
    //         }
    //         timeModal.show();
    //     });
    // });

    //===============================
    //  ğŸ“… ì‹œê°„ì„¤ì • ìŠ¤í¬ë¦½íŠ¸
    //================================
    // $(document).ready(function () {
    //     console.log("â° ì‹œê°„ ì„¤ì • ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œë¨");

        // $('#apply-global-time').click(function () {
        //     let globalStart = $('#start-global').val();
        //     let globalEnd = $('#end-global').val();
        //     console.log("ğŸ“Œ [ì „ì²´ ì ìš©] ì‹œì‘ì‹œê°„:", globalStart, "ì¢…ë£Œì‹œê°„:", globalEnd);
        //     // 1ë¶€í„° dayCountsê¹Œì§€ì˜ ë¦¬ìŠ¤íŠ¸ ìƒì„±
        //     let dayList = Array.from({ length: selectedDates.length }, (_, i) => i + 1);
        //     dayList.forEach(index => {
        //         $(`#start-${index}`).val(globalStart);
        //         $(`#end-${index}`).val(globalEnd);
        //     });
        // });

        // $('#confirm-time-btn').click(function () {
        //     console.log("ğŸ“Œ [ì™„ë£Œ ë²„íŠ¼ í´ë¦­]");
        //     const itineraryJSON = generateItineraryJSON();
        //
        //     // ì¤‘ë³µ í´ë¦­ ë°©ì§€ (ë²„íŠ¼ ë¹„í™œì„±í™”)
        //     $('#confirm-time-btn').prop('disabled', true).text("ì €ì¥ ì¤‘...");
        //
        //     // Ajax ìš”ì²­
        //     $.ajax({
        //         url: "/api/itinerary/create",
        //         type: "POST",
        //         contentType: "application/json",
        //         data: JSON.stringify(itineraryJSON),
        //         beforeSend: function () {
        //             // ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ í‘œì‹œ (ì¶”ê°€ ê°€ëŠ¥)
        //             $('#loading-spinner').show();
        //         },
        //         success: function (response) {
        //             console.log("âœ… ì¼ì • ì €ì¥ ì„±ê³µ:", response);
        //             alert("ì¼ì •ì´ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!");
        //             timeModal.hide();
        //         },
        //         error: function (xhr, status, error) {
        //             console.error("âŒ ì¼ì • ì €ì¥ ì‹¤íŒ¨:", error);
        //             alert("ì¼ì • ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
        //         },
        //         complete: function () {
        //             // ìš”ì²­ ì™„ë£Œ í›„ ë²„íŠ¼ í™œì„±í™” ë° ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ ìˆ¨ê¸°ê¸°
        //             $('#confirm-time-btn').prop('disabled', false).text("ì™„ë£Œ");
        //             $('#loading-spinner').hide();
        //         }
        //     });
        // });

        // $('#back-to-date-btn').click(function () {
        //     console.log("ğŸ“Œ [ë’¤ë¡œê°€ê¸° ë²„íŠ¼ í´ë¦­]");
        //     timeModal.hide();
        //     travelModal.show()
        // });
    // });


    function generateItineraryJSON() {
        // 1. ì„ íƒëœ ë‚ ì§œê°€ ì—†ëŠ” ê²½ìš° ì²˜ë¦¬
        if (!selectedDates || selectedDates.length === 0) {
            alert("ì—¬í–‰ ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.");  // ê²½ê³  ë©”ì‹œì§€ í‘œì‹œ
            return null;
        }

        // 2. itineraryDTO ê°ì²´ ìƒì„±
        const startDateStr = moment(selectedDates[0]).format("YYYY-MM-DD") + "T00:00:00";
        const itinerary = {
            itineraryName: "ì„œìš¸ ì—¬í–‰",           // ì—¬í–‰ ì´ë¦„ (ê¸°ë³¸ê°’ ë˜ëŠ” ì‚¬ìš©ì ì…ë ¥ê°’)
            startDate: startDateStr,              // ì²« ë²ˆì§¸ ì—¬í–‰ ë‚ ì§œ (ì‹œê° 00:00:00 ê³ ì •)
            totalDays: selectedDates.length,      // ì „ì²´ ì—¬í–‰ ì¼ìˆ˜
            transportationType: 1                 // êµí†µ ìˆ˜ë‹¨ ìœ í˜• (ì˜ˆ: 1, ê¸°ë³¸ê°’)
        };

        // 3. ItineraryPerDays ë°°ì—´ ìƒì„±
        const ItineraryPerDays = [
            { dayCount: 0, startTime: "00:00:00", endTime: "00:00:00", dayOfWeek: 0 }, // ë¹ˆì¥ì†Œë¥¼ ì €ì¥í•˜ê¸°ìœ„í•œ ë°°ì—´
            ...selectedDates.map((date, index) => ({
                dayCount: index + 1,
                startTime: $(`#start-${index+1}`).val() + ":00",
                endTime: $(`#end-${index+1}`).val() + ":00",
                dayOfWeek: moment(date).isoWeekday()
            }))
        ];


        // 4. ìµœì¢… JSON ë°ì´í„° êµ¬ì„±
        const itineraryJSON = {
            itinerary: itinerary,
            itineraryPerDays: ItineraryPerDays
        };

        // JSON ê²°ê³¼ë¥¼ ì½˜ì†”ì— ì¶œë ¥ (ê°€ë…ì„±ì„ ìœ„í•´ ë“¤ì—¬ì“°ê¸° í¬í•¨)
        console.log(JSON.stringify(itineraryJSON, null, 2));

        // JSON ë°ì´í„°ë¥¼ ë°˜í™˜í•˜ì—¬ ë‹¤ë¥¸ ê³³ì—ì„œ í™œìš© ê°€ëŠ¥í•˜ë„ë¡ í•¨
        return itineraryJSON;
    }
</script>



<script src="/js/create.js"></script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
