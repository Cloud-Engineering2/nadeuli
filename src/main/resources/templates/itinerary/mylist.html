<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>일정 생성</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Date Range Picker -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css">
    <script src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>

</head>
<body>

<div class="container mt-4">
    <!-- 정렬 콤보박스 -->
    <div class="mb-3">
        <label for="sortSelect" class="form-label">정렬 기준</label>
        <select id="sortSelect" class="form-select">
            <option value="createdDate" data-direction="DESC">최신 등록순</option>
            <option value="startDate" data-direction="ASC">여행 시작일 오름차순</option>
            <option value="startDate" data-direction="DESC">여행 시작일 내림차순</option>
        </select>
    </div>

    <!-- 일정 리스트 -->
    <div id="itineraryList" class="list-group"></div>

    <!-- 더보기 버튼 -->
    <button id="loadMoreBtn" class="btn btn-primary w-100 mt-3">더보기</button>
</div>
<script>
    let currentPage = 0; // 현재 페이지
    const userId = 1;  // 실제 로그인한 사용자 ID
    let sortBy = "createdDate";  // 기본 정렬 필드
    let direction = "DESC";  // 기본 정렬 방향

    // 일정 목록 불러오기 함수
    function loadItineraries(reset = false) {
        $.ajax({
            url: `/api/itinerary/mylist`,
            type: "GET",
            data: {
                userId: userId,
                page: currentPage,
                size: 4, // 한 번에 가져올 개수
                sortBy: sortBy,
                direction: direction
            },
            success: function (response) {
                if (reset) {
                    $("#itineraryList").empty(); // 기존 목록 초기화
                    currentPage = 0; // 페이지 리셋
                }

                // 데이터가 없을 경우 "더보기" 버튼 숨김
                if (response.content.length === 0) {
                    $("#loadMoreBtn").hide();
                    return;
                }

                // 일정 목록 추가
                response.content.forEach(itinerary => {
                    $("#itineraryList").append(`
                    <div class="list-group-item">
                        <h5>${itinerary.itineraryName}</h5>
                        <p>시작일: ${new Date(itinerary.startDate).toLocaleDateString()}</p>
                        <p>종료일: ${new Date(itinerary.endDate).toLocaleDateString()}</p>
                        <p>내 역할: ${itinerary.role}</p>
                    </div>
                `);
                });

                // 현재 페이지 증가
                currentPage++;

                // 더보기 버튼 활성화 여부 결정
                if (response.last) {
                    $("#loadMoreBtn").hide();
                } else {
                    $("#loadMoreBtn").show();
                }
            }
        });
    }

    // 정렬 변경 시 데이터 다시 로드
    $("#sortSelect").on("change", function () {
        sortBy = $(this).val(); // 선택한 정렬 기준
        direction = $(this).find("option:selected").data("direction"); // 정렬 방향
        currentPage = 0; // 페이지 리셋
        loadItineraries(true); // 기존 데이터 초기화 후 다시 로드
    });

    // "더보기" 버튼 클릭 이벤트
    $("#loadMoreBtn").on("click", function () {
        loadItineraries();
    });

    // 페이지 로드 시 첫 데이터 로드
    $(document).ready(function () {
        loadItineraries();
    });
</script>

</body>
</html>
