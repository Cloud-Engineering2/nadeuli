<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>로그인</title>
    <link rel="stylesheet" href="/css/login.css">
</head>
<body>
<div class="login-container">
    <h2>나들이</h2>
    <img src="/images/logo.png" alt="로고" class="logo">
    <p class="subtitle">여행의 계획부터 결산까지</p>
    <p class="subtitle2">나들이와 함께</p>

    <button class="login-btn">로그인</button>

    <button class="kakao-btn" onclick="login('kakao')">
        <img src="/images/kakao_logo.png" alt="카카오 아이콘">카카오 로그인
    </button>

    <button class="google-btn" onclick="login('google')">
        <img src="/images/google_logo.png" alt="구글 아이콘">구글 로그인
    </button>
</div>

<script>
    function login(provider) {
        window.location.href = `/oauth2/authorization/${provider}`;
    }

    async function checkLoginStatus() {
        try {
            const response = await fetch('/auth/user/me', {
                method: 'GET',
                credentials: 'include',
                headers: { 'Authorization': `Bearer ${getCookie('accessToken')}` }
            });

            if (response.ok) {
                window.location.href = "/mypage";
            }
        } catch (error) {
            console.error("🚨 로그인 상태 확인 실패:", error);
        }
    }

    function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(";").shift();
    }

    window.onload = checkLoginStatus;
</script>
</body>
</html>
